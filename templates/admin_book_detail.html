<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Chi tiết Đầu Sách</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>tailwind.config = { theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'] } } } }</script>
</head>
<body class="bg-slate-50 font-sans h-screen flex flex-col overflow-hidden">

    <div class="h-16 bg-white border-b border-slate-200 flex justify-between items-center px-6 shadow-sm flex-shrink-0">
        <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2"><i class="fas fa-book-open text-indigo-600"></i> Chi tiết đầu sách</h2>
        <a href="/admin/books" class="px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-lg font-bold transition flex items-center gap-2"><i class="fas fa-arrow-left"></i> Quay lại</a>
    </div>

    <div class="flex-1 overflow-y-auto p-8">
        <div class="max-w-6xl mx-auto space-y-8">

            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-8">
                <div class="flex flex-col md:flex-row gap-8">
                    <div class="w-full md:w-1/4 flex-shrink-0">
                        <div class="aspect-[2/3] bg-slate-100 rounded-xl overflow-hidden shadow-lg border border-slate-200 relative">
                            <img id="d-img" src="" class="w-full h-full object-cover" onerror="this.src='https://via.placeholder.com/300x450?text=No+Image'">
                        </div>
                    </div>

                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="bg-indigo-50 text-indigo-600 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide" id="d-cat">...</span>
                                <h1 class="text-3xl font-extrabold text-slate-800 mt-2 mb-1" id="d-title">Loading...</h1>
                                <p class="text-lg text-slate-500 font-medium">Tác giả: <span class="text-slate-800 font-bold" id="d-author">...</span></p>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-slate-400 uppercase font-bold">Trạng thái</p>
                                <span id="d-status-badge" class="inline-block mt-1 px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-bold">...</span>
                            </div>
                        </div>

                        <div class="mt-8 grid grid-cols-2 md:grid-cols-4 gap-6 border-y border-slate-100 py-6">
                            <div><p class="text-xs text-slate-400 uppercase font-bold mb-1">Mã ISBN</p><p class="text-slate-800 font-mono font-bold" id="d-isbn">...</p></div>
                            <div><p class="text-xs text-slate-400 uppercase font-bold mb-1">Nhà xuất bản</p><p class="text-slate-800 font-bold" id="d-pub">...</p></div>
                            <div><p class="text-xs text-slate-400 uppercase font-bold mb-1">Năm XB</p><p class="text-slate-800 font-bold" id="d-year">...</p></div>
                            <div><p class="text-xs text-slate-400 uppercase font-bold mb-1">Giá bìa</p><p class="text-indigo-600 font-bold" id="d-price">...</p></div>
                            <div><p class="text-xs text-slate-400 uppercase font-bold mb-1">Ngôn ngữ</p><p class="text-slate-800 font-bold" id="d-lang">...</p></div>
                            <div><p class="text-xs text-slate-400 uppercase font-bold mb-1">Tổng số lượng</p><p class="text-slate-800 font-bold text-xl" id="d-total">0</p></div>
                            <div><p class="text-xs text-slate-400 uppercase font-bold mb-1">Khả dụng</p><p class="text-emerald-600 font-bold text-xl" id="d-avail">0</p></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="p-6 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                    <h3 class="font-bold text-slate-800 text-lg">Danh sách các cuốn trong kho</h3>
                    <span class="text-xs font-bold text-slate-500 bg-slate-200 px-2 py-1 rounded">Vị trí kệ: <span id="d-loc" class="text-slate-800">...</span></span>
                </div>
                <table class="w-full text-left text-sm">
                    <thead class="bg-slate-50 text-slate-500 font-bold uppercase border-b border-slate-100">
                        <tr><th class="p-4 pl-6">Mã vạch</th><th class="p-4">Trạng thái</th><th class="p-4">Vị trí</th></tr>
                    </thead>
                    <tbody id="copy-list" class="divide-y divide-slate-100"></tbody>
                </table>
            </div>

        </div>
    </div>

    <script>
        const isbn = window.location.pathname.split('/').pop();
        const formatter = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' });

        fetch(`/api/book/${isbn}`).then(r=>r.json()).then(d => {
            if(d.status !== 'error'){
                const b = d.book;
                document.getElementById('d-title').innerText = b.title;
                document.getElementById('d-author').innerText = b.author;
                document.getElementById('d-cat').innerText = b.category;
                document.getElementById('d-isbn').innerText = b.isbn;

                // New Fields
                document.getElementById('d-img').src = b.image_url || '';
                document.getElementById('d-pub').innerText = b.publisher || '---';
                document.getElementById('d-year').innerText = b.year || '---';
                document.getElementById('d-price').innerText = b.price ? formatter.format(b.price) : '0 ₫';
                document.getElementById('d-lang').innerText = b.language || 'Tiếng Việt';
                document.getElementById('d-loc').innerText = b.location || 'Chưa cập nhật';

                document.getElementById('d-total').innerText = b.qty_total;
                document.getElementById('d-avail').innerText = b.qty_avail;

                // Status Badge
                const badge = document.getElementById('d-status-badge');
                if(b.qty_avail > 0) { badge.className='inline-block mt-1 px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-bold'; badge.innerText='Đang lưu hành'; }
                else { badge.className='inline-block mt-1 px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-bold'; badge.innerText='Hết sách'; }

                // Copies List
                document.getElementById('copy-list').innerHTML = d.copies.map(c => `
                    <tr class="hover:bg-slate-50">
                        <td class="p-4 pl-6 font-mono font-bold text-slate-700">${c.barcode}</td>
                        <td class="p-4"><span class="px-3 py-1 rounded-full text-xs font-bold uppercase ${c.status==='available' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}">${c.status}</span></td>
                        <td class="p-4 text-slate-500">${c.location || b.location || 'Kho chung'}</td>
                    </tr>
                `).join('');
            }
        });
    </script>
</body>
</html>